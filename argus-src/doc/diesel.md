
# ğŸš€ Diesel å¸¸ç”¨å‘½ä»¤ä¸æ“ä½œé€ŸæŸ¥æ–‡æ¡£ï¼ˆé€‚ç”¨äº SQLiteï¼‰

## ğŸ§± ä¸€ã€å‡†å¤‡é˜¶æ®µ

### 1. å®‰è£… Diesel CLI

```bash
cargo install diesel_cli --no-default-features --features sqlite
```

ğŸ“Œ **ä½œç”¨**ï¼šå®‰è£… Diesel çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œåç»­çš„ `diesel` å‘½ä»¤ä¾èµ–å®ƒã€‚
ğŸ’¡ ä½¿ç”¨ `--features sqlite` æŒ‡å®šæ”¯æŒçš„æ•°æ®åº“ç±»å‹ï¼ˆä¹Ÿæ”¯æŒ postgresã€mysqlï¼‰ã€‚

---

### 2. åˆ›å»º `.env` æ–‡ä»¶

```env
DATABASE_URL=sqlite://db.sqlite
```

ğŸ“Œ **ä½œç”¨**ï¼šå‘Šè¯‰ Diesel æ•°æ®åº“è¿æ¥ä½ç½®ã€‚Diesel ä¼šè‡ªåŠ¨è¯»å– `.env` é‡Œçš„ `DATABASE_URL`ã€‚
ğŸ’¡ `db.sqlite` æ˜¯æ•°æ®åº“æ–‡ä»¶è·¯å¾„ï¼ˆä½ ä¹Ÿå¯ä»¥æ”¾åˆ°å…¶ä»–ä½ç½®ï¼‰ã€‚

---

## ğŸ›  äºŒã€æ•°æ®åº“åˆå§‹åŒ–ç›¸å…³å‘½ä»¤

### 3. åˆå§‹åŒ–æ•°æ®åº“ + åˆ›å»ºè¿ç§»ç›®å½•

```bash
diesel setup
```

ğŸ“Œ **ä½œç”¨**ï¼šå®Œæˆä»¥ä¸‹æ“ä½œï¼š

* åˆ›å»ºæ•°æ®åº“æ–‡ä»¶ï¼ˆå¦‚æœæ˜¯ SQLiteï¼‰
* åˆ›å»º `migrations/` ç›®å½•ï¼ˆç”¨äºæ”¾ç½®æ•°æ®åº“å˜æ›´è„šæœ¬ï¼‰

---

## ğŸ§© ä¸‰ã€æ•°æ®åº“è¿ç§»æ“ä½œ

### 4. åˆ›å»ºä¸€ä¸ªæ–°çš„è¿ç§»è„šæœ¬

```bash
diesel migration generate create_users
```

ğŸ“Œ **ä½œç”¨**ï¼šç”Ÿæˆä¸€ç»„è¿ç§»æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰æ–°çš„æ•°æ®åº“ç»“æ„å˜æ›´ã€‚

âœ… ä¼šç”Ÿæˆï¼š

```
migrations/
  â””â”€â”€ 2025-06-04-xxxxxx_create_users/
        â”œâ”€â”€ up.sql    # å†™æ•°æ®åº“åˆ›å»ºè¯­å¥
        â””â”€â”€ down.sql  # å†™æ•°æ®åº“å›é€€è¯­å¥
```

---

### 5. æ‰§è¡Œæ‰€æœ‰æœªè¿è¡Œçš„è¿ç§»ï¼ˆæ›´æ–°æ•°æ®åº“ç»“æ„ï¼‰

```bash
diesel migration run
```

ğŸ“Œ **ä½œç”¨**ï¼šæ‰§è¡Œæ‰€æœ‰ `up.sql`ï¼ŒæŠŠæ•°æ®åº“ç»“æ„å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚

---

### 6. å›æ»šä¸Šä¸€æ¬¡çš„è¿ç§»

```bash
diesel migration revert
```

ğŸ“Œ **ä½œç”¨**ï¼šæ’¤é”€ä¸Šä¸€æ¬¡æ‰§è¡Œçš„è¿ç§»ï¼ˆæ‰§è¡Œ `down.sql`ï¼‰ã€‚

---

### 7. å›æ»šåˆ°åˆå§‹çŠ¶æ€ï¼ˆæ…ç”¨ï¼‰

```bash
diesel migration redo
```

ğŸ“Œ **ä½œç”¨**ï¼šæ’¤é”€å¹¶é‡æ–°æ‰§è¡Œä¸Šä¸€ä¸ªè¿ç§»ï¼Œç›¸å½“äºï¼š`revert` âœ `run`ã€‚

---

## ğŸ§¾ å››ã€æ¨¡å‹ç”Ÿæˆä¸æ•°æ®äº¤äº’ï¼ˆRust ä»£ç éƒ¨åˆ†ï¼‰

### 8. æ ¹æ®æ•°æ®åº“è¡¨ç»“æ„ç”Ÿæˆ Rust æ¨¡å‹ï¼ˆschema.rsï¼‰

```bash
diesel print-schema > src/schema.rs

# ç›®å‰é¡¹ç›®åœ¨ç”¨
diesel print-schema > src/storage/schema.rs
```

ğŸ“Œ **ä½œç”¨**ï¼šè¯»å–æ•°æ®åº“ç»“æ„ï¼Œç”Ÿæˆå¯¹åº”çš„ Rust è¡¨å®šä¹‰ä»£ç ã€‚
ğŸ’¡ ä½ å¯ä»¥åœ¨é¡¹ç›®é‡Œä½¿ç”¨è¿™äº›å®šä¹‰è¿›è¡ŒæŸ¥è¯¢ã€‚

---

## ğŸ§ª äº”ã€è°ƒè¯• & æ£€æŸ¥çŠ¶æ€

### 9. æŸ¥çœ‹å½“å‰æ•°æ®åº“è¿ç§»çŠ¶æ€

```bash
diesel migration list
```

ğŸ“Œ **ä½œç”¨**ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿ç§»çš„æ‰§è¡ŒçŠ¶æ€ï¼ˆå“ªäº›å·²è¿è¡Œã€å“ªäº›æ²¡è¿è¡Œï¼‰ã€‚

---

# ğŸ—‚ ç¤ºä¾‹å·¥ä½œæµï¼ˆSQLiteï¼‰

```bash
# å®‰è£… CLIï¼ˆä»…ç¬¬ä¸€æ¬¡ï¼‰
cargo install diesel_cli --no-default-features --features sqlite

# è®¾ç½®æ•°æ®åº“åœ°å€
echo DATABASE_URL=sqlite://db.sqlite > .env

# åˆå§‹åŒ–é¡¹ç›®
diesel setup

# åˆ›å»ºä¸€æ¡è¿ç§»è®°å½•
diesel migration generate create_users

# ç¼–è¾‘ up.sql å’Œ down.sqlï¼Œå®šä¹‰æ•°æ®åº“å˜æ›´

# åº”ç”¨è¿ç§»
diesel migration run

# å¦‚æœå†™é”™äº†ï¼Œå›æ»š
diesel migration revert

# æŸ¥çœ‹è¿ç§»çŠ¶æ€
diesel migration list

# è‡ªåŠ¨ç”Ÿæˆ Rust è¡¨ç»“æ„å®šä¹‰
diesel print-schema > src/schema.rs
```

---

# ğŸ“ å¸¸è§æ–‡ä»¶ç»“æ„

```
project/
â”œâ”€â”€ .env                    # æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
â”œâ”€â”€ migrations/             # æ‰€æœ‰è¿ç§»è®°å½•
â”‚   â””â”€â”€ <timestamp>_<name>/
â”‚       â”œâ”€â”€ up.sql
â”‚       â””â”€â”€ down.sql
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs
â”‚   â””â”€â”€ schema.rs           # è‡ªåŠ¨ç”Ÿæˆçš„è¡¨ç»“æ„
```

---

